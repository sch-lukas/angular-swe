meta {
  name: Neues Buch mit ungÃ¼ltigen Daten
  type: http
  seq: 3
}

post {
  url: {{restUrl}}
  body: json
  auth: bearer
}

headers {
  ~: 
}

auth:bearer {
  token: {{TOKEN}}
}

body:json {
  {
    "isbn": "falsche-ISBN",
    "rating": -1,
    "art": "UNSICHTBAR",
    "preis": -1,
    "rabatt": 2,
    "lieferbar": true,
    "datum": "2025-02-30T00:00:00Z",
    "homepage": "anyHomepage",
    "titel": {
      "titel": "?!",
      "untertitel": "Untertitelinvalid"
    }
  }
}

assert {
  res.status: eq 400
  res.headers['content-type']: matches ^application\/json(; charset=utf-8)?
  res.body: isJson
  res.body: isNotEmpty
  res.body.statusCode: eq 400
  res.body.error: eq Bad Request
}

tests {
  test('Fehlermeldungen im Response Body', () => {
    const { message } = res.getBody();
    const props = ['titel.titel', 'isbn', 'rating', 'art', 'preis', 'rabatt', 'datum', 'homepage'];
    expect(message).to.be.an('array').that.has.a.lengthOf(props.length);
    message.forEach(msg => expect(msg).to.be.a('string').that.includes.oneOf(props));
  });
}

settings {
  encodeUrl: true
  timeout: 0
}
