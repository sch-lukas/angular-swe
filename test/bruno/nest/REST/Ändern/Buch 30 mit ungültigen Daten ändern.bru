meta {
  name: Buch 30 mit ungültigen Daten ändern
  type: http
  seq: 6
}

put {
  url: {{restUrl}}/:id
  body: json
  auth: bearer
}

params:path {
  id: 30
}

headers {
  If-Match: "0"
}

auth:bearer {
  token: {{TOKEN}}
}

body:json {
  {
    "isbn": "falsche-ISBN",
    "rating": -1,
    "art": "UNSICHTBAR",
    "preis": "-1",
    "rabatt": "2",
    "lieferbar": true,
    "datum": "12345-123-123",
    "homepage": "anyHomepage"
  }
}

assert {
  res.status: eq 400
  res.headers['content-type']: matches ^application\/json(; charset=utf-8)?
  res.body.statusCode: eq 400
  res.body.error: eq Bad Request
  res.body.message: isArray
  res.body.message: isNotEmpty
}

tests {
  test('Fehlermeldungen im Response Body', () => {
    const { message } = res.getBody();
    const props = ['isbn', 'rating', 'art', 'preis', 'rabatt', 'datum', 'homepage'];
    message.forEach(msg => expect(msg).to.be.a('string').that.includes.oneOf(props));
  });
}

settings {
  encodeUrl: true
  timeout: 0
}
