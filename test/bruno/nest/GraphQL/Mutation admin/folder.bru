meta {
  name: Mutation admin
  seq: 3
}

auth {
  mode: bearer
}

auth:bearer {
  token: {{TOKEN}}
}

script:pre-request {
  const axios = require('axios');
  // const util = require('util'); // fuer inspect() bei rekursiven JSON-Objekten
  
  // "Developer Mode" statt "Safe" erforderlich
  const https = require('https');
  const httpsAgent = new https.Agent({
   rejectUnauthorized: false,
  });
  
  const graphqlUrl = bru.getFolderVar('graphqlUrl');
  const username = bru.getEnvVar('username');
  const password = bru.getEnvVar('password');
  // https://axios-http.com/docs/post_example
  const response = await axios.post(
    graphqlUrl,
    {
      query: `
        mutation {
          token(username: "${username}", password: "${password}") {
            access_token
          }
        }
      `
    },
    // https://axios-http.com/docs/req_config
    { 'Content-Type': 'application/json', httpsAgent },
  );
  
  // console.log(`response=${util.inspect(response)}`);
  const token = response.data.data.token.access_token;
  console.log(`token=${token}`)
  bru.setVar('TOKEN', token);
}

docs {
  Neuanlegen, Ändern und Löschen mit der GraphQL-Schnittstelle
}
