meta {
  name: Suche Buch mit ID 1
  type: graphql
  seq: 1
}

post {
  url: {{graphqlUrl}}
  body: graphql
  auth: inherit
}

headers {
  Accept: application/graphql-response+json
}

body:graphql {
  query ($id: ID! = "1") {
    buch(id: $id) {
      isbn
      version
      rating
      art
      preis
      lieferbar
      datum
      homepage
      schlagwoerter
      titel {
          titel
      }
      rabatt(short: true)
    }
  }
}

body:graphql:vars {
  {
    "id": "1"
  }
}

assert {
  res.status: eq 200
  res.headers['content-type']: matches ^application\/graphql-response\+json(; charset=utf-8)?$
  res.body.data.buch.isbn: isString
  res.body.data.buch.version: gte 0
  res.body.data.buch.rating: gte 0
  res.body.data.buch.art: isString
  res.body.data.buch.preis: gte 0
  res.body.data.buch.lieferbar: isBoolean
  res.body.data.buch.datum: isString
  res.body.data.buch.homepage: isString
  res.body.data.buch.schlagwoerter: isArray
  res.body.data.buch.titel.titel: isString
  res.body.data.buch.titel.titel: isNotEmpty
  res.body.data.buch.rabatt: matches  %$
}

script:post-response {
  test('Body mit den Properties', () => {
      const body = res.getBody();
      const { buch } = body.data;
      const { isbn, version, rating, art, preis, lieferbar, datum, homepage, schlagwoerter, titel, rabatt } = buch;
      expect(isbn).to.be.a('string');
      expect(version).to.be.a('number').that.is.gte(0);
      expect(rating).to.be.a('number').that.is.gte(0);
      expect(art).to.be.a('string');
      expect(preis).to.be.a('number').that.is.gte(0);
      expect(lieferbar).to.be.a('boolean');
      expect(datum).to.be.a('string');
      expect(homepage).to.be.a('string');
      expect(schlagwoerter).to.be.an('array');
      expect(titel.titel).to.be.a('string');
      expect(rabatt).to.match(/ %$/u);
  });
}

settings {
  encodeUrl: true
  timeout: 0
}
